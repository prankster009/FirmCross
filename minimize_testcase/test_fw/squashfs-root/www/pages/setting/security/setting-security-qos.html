<script type="text/javascript">
var OBJ_LIST = ['qos','qosPolicy']
var ORIGINAL_OBJ_DATA = {}
var MODIFIED_OBJ_DATA = {}
var login_ip = "0.0.0.0";
var INFO_DATA = {};
var INFO_LIST = ['dhcpClientT'];
var macs="";
var qos_kbps_mbps_str_list = ['qos_kbps', 'qos_mbps']
var qos_kbps_mbps_val_list = ['0', '1']
var qos_upstream_bandwidth_str_list = ['qos_auto', 'qos_manual']
var qos_upstream_bandwidth_val_list = ['0', '1']
var qos_category_str_list = ['qos_applications', 'qos_online_games', 'qos_mac_address', 'qos_voice_device']
var qos_category_val_list = ['0', '1', '2', '3']
var qos_applications_str_list = ['qos_msn_messenger', 'qos_skype', 'qos_yahoo_messenger', 'qos_windows_live_messenger','qos_aim', 'qos_windows_media_player', 'qos_realplayer', 'qos_quicktime', 'qos_iTunes', 'qos_yahoo_music_jukebox', 'qos_rhapsody', 'qos_add_new_app']
var app_mapping = ["msn","skype","ym","wlm","aim","wmp","real","qtime","itunes","ymj","rhap"]
var qos_applications_val_list = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '0']

var qos_game_str_list= ['qos_neverwinter_nights_2', 'qos_enemy_territory', 'qos_world_in_conflict', 'qos_call_of_duty_4', 'qos_sins_of_a_solar_empire', 'qos_half_life_2_the_oranger_box', 'qos_crysis', 'qos_frontlines', 'qos_warhammer_40000_dawn_of_war_soulstorm', 'qos_stalker_shadow_of_chernoby', 'qos_world_of_warcraft', 'qos_supreme_commander', 'qos_titan_quest_immortal_throne', 'qos_battle_field_2142', 'qos_half_life_2_episode_1', 'qos_heroes_of_might_magic_v', 'qos_guild_wars_factions', 'qos_add_new_game']
var game_mapping = ["nwn2","et","wic","cod4","sins","hl2ob","crysis","fl","wh","stalker","wow","sc","tq","b2142","hl2eo","hom","gwf"]
var qos_game_val_list = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '0']
var qos_priority_str_list = ['qos_high', 'qos_medium', 'qos_normal', 'qos_low']
var qos_priority_val_list = ['3', '2', '1', '0']
var qos_pro1_str_list = ['qos_disabled','qos_tcp', 'qos_udp', 'qos_both']
var qos_pro1_val_list = ['0','1', '2', '3']
var qos_pro2_str_list = ['qos_disabled','qos_tcp', 'qos_udp', 'qos_both']
var qos_pro2_val_list = ['0','1', '2', '3']
var qos_pro3_str_list = ['qos_disabled','qos_tcp', 'qos_udp', 'qos_both']
var qos_pro3_val_list = ['0','1', '2', '3']
var QosList = new Array();
var tmpQosList = new Array();
var game_name = new Array("New", "Neverwinter Nights 2", "Enemy Territory", "World In Conflict", "Call of Duty 4", "Sins of A Solar Empire", "Half-Life 2:The Orange Box", "Crysis", "Frontlines", "Warhammer 40,000:Dawn of War:Soulstorm", "S.T.A.L.K.E.R.:Shadow Of Chernoby", "World Of Warcraft", "Supreme Commander", "Titan Quest: Immortal Throne", "Battle field 2142", "Half-Life 2: Episode 1", "Heroes of Might & Magic V", "Guild Wars Factions I & II");
var app_name = new Array("New", "MSN Messenger", "Skype", "Yahoo Message", "Windows Live Messenger", "AIM", "Windows Media Player", "RealPlayer", "QuickTime", "iTunes", "Yahoo Music Jukebox", "Rhapsody");
ie4 = ((navigator.appName == "Microsoft Internet Explorer") && (parseInt(navigator.appVersion) >= 4 ))
ns4 = ((navigator.appName == "Netscape") && (parseInt(navigator.appVersion) < 6 ))
ns6 = ((navigator.appName == "Netscape") && (parseInt(navigator.appVersion) >= 6 ))
var DegMode = 0;
var wl_wme_count = 1;
var wl_wme_no_ack_count = 0;
var qos_enable_count = 1;
</script>
<div class="table-title qos_zone">
<span class="multi_lang" id="lang_qos_zone_qos_title"></span>
</div>
<hr class="table-title-underline qos_zone">
<form>
<table class="table table-info qos_zone">
<tbody>
<tr id="tr_qos_wmm_support" >
<td><script>draw_checkbox('qos_wmm_support', 'lang_qos_wmm_support_title', '1', "sel_qos_wmm();SelWME(this.form,'1')");</script><span id="checkbox_div_qos_wmm_support"></span>
</td>
<td>
<span class="multi_lang" id="lang_qos_default_enable"></span>
</td>
</tr>
<tr id="tr_qos_no_ack" >
<td><script>draw_checkbox('qos_no_ack', 'lang_qos_no_ack_title', '1', "sel_qos_no_ack();");</script><span id="checkbox_div_qos_no_ack"></span>
</td>
<td>
<span >&nbsp;</span>
</td>
</tr>
</tbody>
</table>
<div class="table-title inter_access_zone">
<span class="multi_lang" id="lang_qos_zone_inter_access_title"></span>
</div>
<hr class="table-title-underline inter_access_zone">
<table class="table table-info inter_access_zone">
<tbody>
<tr id="tr_qos_internet_access_priority" >
<td><script>draw_checkbox('qos_internet_access_priority', 'lang_qos_internet_access_priority_title', '1', "sel_qos_iap();SetQos()");</script><span id="checkbox_div_qos_internet_access_priority"></span>
</td>
<td>
<span >&nbsp;</span>
</td>
</tr>
<tr id="tr_qos_upstream_bandwidth" >
<td>
<span class="multi_lang" id="lang_qos_upstream_bandwidth_title"></span>
</td>
<td id="select_td">
<script>(function(){draw_select('qos_upstream_bandwidth', qos_upstream_bandwidth_str_list, qos_upstream_bandwidth_val_list,'rate_grey(this.value,this.form);sel_qos_upstream_bandwidth()', '');})();</script>
<div id="select_div_qos_upstream_bandwidth" style="display: inline;"></div>
<input maxlength="32" value="" name="qos_ub_value" id="qos_ub_value" onblur="" size="4" class="logger_bot">
<script>(function(){draw_select('qos_kbps_mbps', qos_kbps_mbps_str_list, qos_kbps_mbps_val_list,'sel_qos_kbps_mbps()', '');})();</script>
&nbsp;
<div id="select_div_qos_kbps_mbps" style="display: inline;"></div>
</td>
</tr>
<tr id="tr_qos_category" >
<td>
<span class="multi_lang" id="lang_qos_category_title"></span>
</td>
<td id="select_td">
<script>(function(){draw_select('qos_category', qos_category_str_list, qos_category_val_list,'sel_qos_category()', '');})();</script>
<div id="select_div_qos_category"></div>
<span class="multi_lang" id="qos_mac_msg"></span>
</td>
</tr>
</tbody>
</table>
<div class="table-title application_zone">
<span class="multi_lang" id="lang_qos_zone_application_title"></span>
</div>
<hr class="table-title-underline application_zone">
<table class="table table-info application_zone">
<tbody>
<tr id="tr_qos_applications" >
<td>
<span class="multi_lang" id="lang_qos_applications_title"></span>
</td>
<td id="select_td">
<script>(function(){draw_select('qos_applications', qos_applications_str_list, qos_applications_val_list,'DisplayNewRow(this.value);sel_qos_applications()', '');})();</script>
<div id="select_div_qos_applications"></div>
</td>
</tr>
<tr id="tr_qos_game" >
<td>
<span class="multi_lang" id="lang_qos_game_title"></span>
</td>
<td id="select_td">
<script>(function(){draw_select('qos_game', qos_game_str_list, qos_game_val_list,'DisplayNewRow(this.value);sel_qos_game()', '');})();</script>
<div id="select_div_qos_game"></div>
</td>
</tr>
<tr id="tr_qos_enter_name" >
<td>
<span class="multi_lang" id="lang_qos_enter_a_name_title"></span>
</td>
<td>
<input maxlength="32" value="" name="qos_enter_name_value" id="qos_enter_name_value" onblur="" size="19" class="logger_bot">
</td>
</tr>
<tr id="tr_qos_mac_address" >
<td>
<span class="multi_lang" id="lang_qos_mac_address_title"></span>
</td>
<td>
<input maxlength="17" value="" name="qos_mac_address_value" id="qos_mac_address_value" onblur="valid_macs_all(this)" size="15" class="logger_bot">
</td>
</tr>
<tr id="tr_qos_range" >
<td>
<span class="multi_lang" id="lang_qos_port_range_title"></span>
</td>
<td>
<table class="table table-info-bg table-bordered">
<tr>
<td>&nbsp;</td>
<td>
<input maxlength="5" value="" name="qos_fport1_value" id="qos_fport1_value" onblur="checkportrange()" size="5" class="logger_bot">
<span class="multi_lang" id="lang_qos_to"></span>
<input maxlength="5" value="" name="qos_tport1_value" id="qos_tport1_value" onblur="checkportrange()" size="5" class="logger_bot">
&nbsp;
</td>
<td id="select_td" style="width:50px">
<script>(function(){draw_select('qos_pro1', qos_pro1_str_list, qos_pro1_val_list,'sel_qos_pro1()', '');})();</script>
<div id="select_div_qos_pro1"></div>
</td>
</tr>
<tr>
<td><span class="multi_lang" id="lang_qos_optional"></span></td>
<td>
<input maxlength="5" value="" name="qos_fport2_value" id="qos_fport2_value" onblur="checkportrange()" size="5" class="logger_bot">
<span class="multi_lang" id="lang_qos_to"></span>
<input maxlength="5" value="" name="qos_tport2_value" id="qos_tport2_value" onblur="checkportrange()" size="5" class="logger_bot">
&nbsp;
</td>
<td id="select_td" style="width:auto">
<script>(function(){draw_select('qos_pro2', qos_pro2_str_list, qos_pro2_val_list,'sel_qos_pro2()', '');})();</script>
<div id="select_div_qos_pro2"></div>
</td>
</tr>
<tr>
<td><span class="multi_lang" id="lang_qos_optional"></span></td>
<td>
<input maxlength="5" value="" name="qos_fport3_value" id="qos_fport3_value" onblur="checkportrange()" size="5" class="logger_bot">
<span class="multi_lang" id="lang_qos_to"></span>
<input maxlength="5" value="" name="qos_tport3_value" id="qos_tport3_value" onblur="checkportrange()" size="5" class="logger_bot">
&nbsp;
</td>
<td id="select_td">
<script>(function(){draw_select('qos_pro3', qos_pro3_str_list, qos_pro3_val_list,'sel_qos_pro3()', '');})();</script>
<div id="select_div_qos_pro3"></div>
</td>
</tr>
</table>
</td>
</tr>
<tr id="tr_qos_priority" >
<td>
<span class="multi_lang" id="lang_qos_priority_title"></span>
</td>
<td id="select_td">
<script>(function(){draw_select('qos_priority', qos_priority_str_list, qos_priority_val_list,'sel_qos_priority()', '');})();</script>
<div id="select_div_qos_priority"></div>
</td>
</tr>
<tr id="tr_qos_voice_priority" >
<td>
<span class="multi_lang" id="lang_qos_priority_title"></span>
</td>
<td id="select_td">
<script>(function(){draw_select('qos_voice_priority', qos_priority_str_list, qos_priority_val_list,'sel_qos_voice_priority()', '');})();</script>
<div id="select_div_qos_voice_priority"></div>
</td>
</tr>
<tr id="tr_qos_apply_button" >
<td>
</td>
<td>
<button class="btn btn-primary multi_lang logger_bot" id="btnApply" type="button" name="btnApply" onclick="showSummary()"></button>
</td>
</tr>
</tbody>
</table>
<div class="TitleofContent"><span class="multi_lang" id="lang_qos_summary"></span></div><br>
<table class="table table-info-bg">
<thead>
<tr>
<th><span class="multi_lang" id="lang_qos_priority"></span></th>
<th><span class="multi_lang" id="lang_qos_name"></span></th>
<th><span class="multi_lang" id="lang_qos_information"></span></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody id="tabSummary"></tbody>
</table>
<div class="form-actions">
<button class="btn btn-primary multi_lang logger_bot" id="btnSave" type="button" name="" onclick="page_save()"></button>
<button class="btncancel multi_lang logger_bot" id="btnCancel" type="button" name="" onclick="page_cancel()"></button>
</div>
</form>
<script language="javascript" type="text/javascript">
page_tag='security_qos'
$(document).ready(function(){
$.lang_load("security_qos");
page_initial()
inject_log_bot()
escape_detection();
});

function sel_qos_upstream_bandwidth(mode){
if(typeof(mode) == "undefined"){
mode = $("#qos_upstream_bandwidth").val()
}else{
$("#qos_upstream_bandwidth").val(mode);
}
eval('var dy_id="L.security_qos.'+$("#qos_upstream_bandwidth option:selected").attr("id")+'"')
$("#qos_upstream_bandwidth").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}
function sel_qos_kbps_mbps(mode){
if(typeof(mode) == "undefined"){
mode = $("#qos_kbps_mbps").val()
}else{
$("#qos_kbps_mbps").val(mode);
}
eval('var dy_id="L.security_qos.'+$("#qos_kbps_mbps option:selected").attr("id")+'"')
$("#qos_kbps_mbps").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}
function IsEmpty(aText)
{
if ( (aText.value.length==0) || (aText.value==null))
{
return true ;
}
else
{
return false ;
}
}
function checkValid(category) {
var f = document.forms[0];
var funreturn = true;
if(DegMode) alert(category);
if(category == 2 || category == 3)
{
if(f.qos_mac_address_value.value == "00:00:00:00:00:00")
{
alert(L.security_qos.lang_qos_error_msg2);
return false;
}
}
if(category == 0 || category == 1)
{
if(document.getElementById('tr_qos_range').style.display == "none") return true;
if(IsEmpty(f.qos_fport1_value) == false)
{
if(valid_range(f.qos_fport1_value, 1, 65535, "") == false) return false;
if(IsEmpty(f.qos_tport1_value) == false)
{
if(valid_range(f.qos_tport1_value, 1, 65535, "") == false) return false;
/*Jemmy port from Alpha for check to port great than from port 2009.11.16*/
if(parseInt(f.qos_fport1_value.value) > parseInt(f.qos_tport1_value.value))
{
var tmp = f.qos_fport1_value.value;
f.qos_fport1_value.value = f.qos_tport1_value.value;
f.qos_tport1_value.value = tmp;
}
}
else
{
alert(L.security_qos.lang_qos_error_msg3);
return false;
}
}
else
{
alert(L.security_qos.lang_qos_error_msg3);
return false;
}
if(IsEmpty(f.qos_fport2_value) == false)
{
if(valid_range(f.qos_fport2_value, 1, 65535, "") == false) return false;
if(IsEmpty(f.qos_tport2_value) == false)
{
if(valid_range(f.qos_tport2_value, 1, 65535, "") == false) return false;
/*Jemmy port from Alpha for check to port great than from port 2009.11.16*/
if(parseInt(f.qos_fport2_value.value) > parseInt(f.qos_tport2_value.value))
{
var tmp = f.qos_fport2_value.value;
f.qos_fport2_value.value = f.qos_tport2_value.value;
f.qos_tport2_value.value = tmp;
}
}
else
{
alert(L.security_qos.lang_qos_error_msg3);
return false;
}
}
else
{
if(IsEmpty(f.qos_tport2_value) == false)
{
alert(L.security_qos.lang_qos_error_msg3);
return false;
}
}
if(IsEmpty(f.qos_fport3_value) == false)
{
if(valid_range(f.qos_fport3_value, 1, 65535, "") == false) return false;
if(IsEmpty(f.qos_tport3_value) == false)
{
if(valid_range(f.qos_tport3_value, 1, 65535, "") == false) return false;
/*Jemmy port from Alpha for check to port great than from port 2009.11.16*/
if(parseInt(f.qos_fport3_value.value) > parseInt(f.qos_tport3_value.value))
{
var tmp = f.qos_fport3_value.value;
f.qos_fport3_value.value = f.qos_tport3_value.value;
f.qos_tport3_value.value = tmp;
}
}
else
{
alert(L.security_qos.lang_qos_error_msg3);
return false;
}
}
else
{
if(IsEmpty(f.qos_tport3_value) == false)
{
alert(L.security_qos.lang_qos_error_msg3);
return false;
}
}
}
return true;
}
function QosEntry(idx, category, selValue, name, priority, infor) {
this.idx = idx;
this.cate = category;
this.val = selValue;
this.name = name;
this.pri = priority;
this.infor = infor;
}
function tmpQosEntry(idx, category, selValue, name, priority, infor) {
//this.idx = idx;
this.name = "qos"+idx;
this.category = category;
//this.val = selValue;
this.serviceName = name;
this.priority = priority;
if(category==0 || category==1){
this.deviceMac=""
if(selValue==0){
this.servicePortStart1 = infor[0];
this.servicePortEnd1 = infor[1];
this.serviceProto1 = infor[2];
this.servicePortStart2 = infor[3];
this.servicePortEnd2 = infor[4];
this.serviceProto2 = infor[5];
this.servicePortStart3 = infor[6];
this.servicePortEnd3 = infor[7];
this.serviceProto3 = infor[8];
}else{
this.servicePortStart1 = "";
this.servicePortEnd1 = "";
this.serviceProto1 = "";
this.servicePortStart2 = "";
this.servicePortEnd2 = "";
this.serviceProto2 = "";
this.servicePortStart3 = "";
this.servicePortEnd3 = "";
this.serviceProto3 = "";
}
}
else if(category==2||category==3){
this.deviceMac=infor;
this.servicePortStart1 = "";
this.servicePortEnd1 = "";
this.serviceProto1 = "";
this.servicePortStart2 = "";
this.servicePortEnd2 = "";
this.serviceProto2 = "";
this.servicePortStart3 = "";
this.servicePortEnd3 = "";
this.serviceProto3 = "";
}
}
function modifyQosEntry(category) {
var f = document.forms[0];
var appName = "none";
var infor = "none";
var priority = 0;
var selValue = 0;
var i;
var tmpAppName;
switch (category) {
case "0": //App
case "1": //Games
if(category == "0") var tmp = f.qos_applications.value;
else var tmp = f.qos_game.value;
if(tmp == 0) {
var rangeArray = new Array("0", "0", "0", "0", "0", "0", "0", "0", "0");
rangeArray[0] = f.qos_fport1_value.value;
rangeArray[1] = f.qos_tport1_value.value;
rangeArray[2] = f.qos_pro1.value;
if(f.qos_fport2_value.value) {
rangeArray[3] = f.qos_fport2_value.value;
rangeArray[4] = f.qos_tport2_value.value;
rangeArray[5] = f.qos_pro2.value;
}
if(f.qos_fport3_value.value) {
rangeArray[6] = f.qos_fport3_value.value;
rangeArray[7] = f.qos_tport3_value.value;
rangeArray[8] = f.qos_pro3.value;
}
infor = rangeArray;
appName = f.qos_enter_name_value.value;
tmpAppName = f.qos_enter_name_value.value;
} else {
selValue = tmp;
if(category == "0"){
appName = app_name[tmp];
tmpAppName = app_mapping[tmp-1];
}
else{
appName = game_name[tmp];
tmpAppName = game_mapping[tmp-1];
}
}
priority = f.qos_priority.value;
break;
case "2": //MAC
appName = f.qos_enter_name_value.value;
tmpAppName = f.qos_enter_name_value.value;
infor = f.qos_mac_address_value.value;
priority = f.qos_priority.value;
break;
case "4": //Ethernet Port
//selValue = f.Ethernet.value;
appName = "Ethernet Port " + selValue;
priority = f.qos_priority.value;
break;
case "3": //Voice
appName = f.qos_enter_name_value.value;
tmpAppName = f.qos_enter_name_value.value;
infor = f.qos_mac_address_value.value;
priority = f.qos_voice_priority.value;
break;
default:
alert(L.common.fail_title);
}
if(appName == null || appName == "")
{
alert(L.security_qos.lang_qos_error_msg4);
return false;
}
var portstr;
if(selValue == "0")
{
for(i = 0; i < app_name.length; i++)
{
if(appName == app_name[i]) //Modified 2010-02-04
{
alert(L.security_qos.lang_qos_error_msg1); //L.security_qos.lang_qos_error_msg1 = "This Application Name has already been reserved. It can't be added twice."
return false;
}
}
for(i = 0; i < game_name.length; i++)
{
if(appName == game_name[i]) //Modified 2010-02-04
{
alert(L.security_qos.lang_qos_error_msg1);
return false;
}
}
/*
for(i=1; i<5; i++)
{
portstr = "Ethernet Port "+i;
if ( appName.indexOf(portstr)!=-1)
{
alert(L.security_qos.lang_qos_error_msg1);
return false ;
}
}
*/
}
var idx = 0;
if(f.qos_category.disabled == 1) idx = CurrentTrId;
else idx = QosList.length;
QosList[idx] = new QosEntry(idx, category, selValue, appName, priority, infor);

tmpQosList[idx] = new tmpQosEntry(idx, category, selValue, tmpAppName, priority, infor);

return true;
}
function resetElement() {
var F = document.forms[0];
F.qos_category.disabled = 0;
update_selected(F.qos_category);
F.qos_applications.disabled = 0;
update_selected(F.qos_applications);
F.qos_game.disabled = 0;
update_selected(F.qos_game);
F.qos_enter_name_value.value = '';
F.qos_enter_name_value.disabled = 0;
F.qos_mac_address_value.value = '00:00:00:00:00:00';
F.qos_fport1_value.value = '';
F.qos_tport1_value.value = '';
F.qos_fport2_value.value = '';
F.qos_tport2_value.value = '';
F.qos_tport2_value.disabled = 1;
F.qos_fport3_value.value = '';
F.qos_tport3_value.value = '';
F.qos_tport3_value.disabled = 1;
sel_qos_pro1('1');
sel_qos_pro2('1');
sel_qos_pro3('1');
F.qos_priority.selectedIndex = 1;
update_selected(F.qos_priority);
F.qos_voice_priority.selectedIndex = 1;
update_selected(F.qos_voice_priority);
}
function cateChange(category)
{
var imgHeight = new Array("", "81", "81", "106", "81", "106");

document.getElementById('qos_mac_msg').innerHTML = "";
document.getElementById('tr_qos_applications').style.display = "none";
document.getElementById('tr_qos_game').style.display = "none";
document.getElementById('tr_qos_enter_name').style.display = "none";
document.getElementById('tr_qos_mac_address').style.display = "none";
//document.getElementById('trEth').style.display = "none";
document.getElementById('tr_qos_range').style.display = "none";
document.getElementById('tr_qos_priority').style.display = "none";
document.getElementById('tr_qos_voice_priority').style.display = "none";
document.getElementById('tr_qos_apply_button').style.display = "none";

document.forms[0].qos_priority.value = 2;
switch (category) {
case "0":
document.forms[0].qos_applications.value = 1;
document.forms[0].qos_enter_name_value.value = "";
document.forms[0].qos_fport1_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport1_value.value = ""; //Add 2010-02-10
document.forms[0].qos_fport2_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport2_value.value = ""; //Add 2010-02-10
document.forms[0].qos_fport3_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport3_value.value = ""; //Add 2010-02-10
sel_qos_pro1('1');
sel_qos_pro2('1');
sel_qos_pro3('1');
document.getElementById('tr_qos_applications').style.display = "";
document.getElementById('tr_qos_priority').style.display = "";
break;
case "1":
document.forms[0].qos_game.value = 1;
document.forms[0].qos_enter_name_value.value = "";
document.forms[0].qos_fport1_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport1_value.value = ""; //Add 2010-02-10
document.forms[0].qos_fport2_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport2_value.value = ""; //Add 2010-02-10
document.forms[0].qos_fport3_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport3_value.value = ""; //Add 2010-02-10
sel_qos_pro1('1');
sel_qos_pro2('1');
sel_qos_pro3('1');
document.getElementById('tr_qos_game').style.display = "";
document.getElementById('tr_qos_priority').style.display = "";
break;
case "2":
document.forms[0].qos_enter_name_value.value = "";
document.forms[0].qos_mac_address_value.value = "00:00:00:00:00:00"; //Add 2010-02-04
document.getElementById('qos_mac_msg').innerHTML = "&nbsp;" + L.security_qos.lang_qos_my_current_pcs_mac_address + ": <b>b0:0c:d1:52:a5:de </b>";
document.getElementById('tr_qos_enter_name').style.display = "";
document.getElementById('tr_qos_mac_address').style.display = "";
document.getElementById('tr_qos_priority').style.display = "";
break;
case "4":
document.forms[0].Ethernet.value = 1;
//document.getElementById('trEth').style.display = "";
document.getElementById('tr_qos_priority').style.display = "";
break;
case "3":
document.forms[0].qos_voice_priority.value = 3;
document.forms[0].qos_enter_name_value.value = "";
document.forms[0].qos_mac_address_value.value = "00:00:00:00:00:00"; //Add 2010-02-04
document.getElementById('tr_qos_enter_name').style.display = "";
document.getElementById('tr_qos_mac_address').style.display = "";
document.getElementById('tr_qos_voice_priority').style.display = "";
break;
default:
alert(L.common.fail_title);
break;
}
document.getElementById('tr_qos_apply_button').style.display = "";
}
function IsCrossRange(n1,n2,n3,n4,p1,p2)
{
var a,b,c,d ;
a = parseInt(n1,10);
b = parseInt(n2,10);
c = parseInt(n3,10);
d = parseInt(n4,10);
if ( a==0 && b==0 && c==0 && d==0 ) return false ;
if ( p1!=p2 && p1!=0 && p2!=0 ) return false ;
if ( a<=c && b>=c && ((p1==0 || p2==0) || (p1==p2))) return true ;
if ( a<=d && b>=d && ((p1==0 || p2==0) || (p1==p2))) return true ;
if ( a>=c && b<=d && ((p1==0 || p2==0) || (p1==p2))) return true ;
return false ;
}
function choose_enable(en_object)
{
if(!en_object)	return;
en_object.disabled = false;			// netscape 4.x can not work, but 6.x can work
if( en_object.type && (en_object.type.toLowerCase() == "radio" || en_object.type.toLowerCase() == "checkbox") )
update_checked(en_object);
if( en_object.tagName && (en_object.tagName.toLowerCase() == "select") )
update_selected(en_object);
}
function choose_disable(dis_object)
{
if(!dis_object)	return;
dis_object.disabled = true;
if( dis_object.type && (dis_object.type.toLowerCase() == "radio" || dis_object.type.toLowerCase() == "checkbox") )
update_checked(dis_object);
if( dis_object.tagName && (dis_object.tagName.toLowerCase() == "select") )
update_selected(dis_object);
}
function checkportrange()
{
var f = document.forms[0];
var en_portcheck = false;
if((IsEmpty(f.qos_fport1_value) == false) && (IsEmpty(f.qos_tport1_value) == false))
{
choose_enable(f.qos_fport2_value);
choose_enable(f.qos_tport2_value);
}
else
{
f.qos_fport2_value.value = "";
f.qos_tport2_value.value = "";
choose_disable(f.qos_fport2_value);
choose_disable(f.qos_tport2_value);
}
if((IsEmpty(f.qos_fport2_value) == false) && (IsEmpty(f.qos_tport2_value) == false))
{
choose_enable(f.qos_fport3_value);
choose_enable(f.qos_tport3_value);
en_portcheck = true;
}
else
{
f.qos_fport3_value.value = "";
f.qos_tport3_value.value = "";
choose_disable(f.qos_fport3_value);
choose_disable(f.qos_tport3_value);
}
if(en_portcheck == true)
{
r1 = f.qos_fport1_value.value;
r2 = f.qos_tport1_value.value;
r3 = f.qos_fport2_value.value;
r4 = f.qos_tport2_value.value;
r5 = f.qos_fport3_value.value;
r6 = f.qos_tport3_value.value;
if(IsEmpty(f.qos_fport1_value) == false && IsEmpty(f.qos_tport1_value) == false && IsEmpty(f.qos_fport2_value) == false && IsEmpty(f.qos_tport2_value) == false)
{
if(IsCrossRange(r1, r2, r3, r4) == true)
{
alert("errmsg.err67");
f.qos_fport2_value.value = "";
f.qos_tport2_value.value = "";
return;
}
}
if(IsEmpty(f.qos_fport3_value) == false && IsEmpty(f.qos_tport3_value) == false)
{
if(IsCrossRange(r1, r2, r5, r6) == true)
{
alert("errmsg.err67");
f.qos_fport3_value.value = "";
f.qos_tport3_value.value = "";
return;
}
if(IsCrossRange(r3, r4, r5, r6) == true)
{
alert("errmsg.err67");
f.qos_fport3_value.value = "";
f.qos_tport3_value.value = "";
return;
}
}
}
}
function SelWME(F, I)
{
if(F.qos_wmm_support.checked == true) {
choose_enable(F.qos_no_ack);
} else {
choose_disable(F.qos_no_ack);
}
wl_wme_count = wl_wme_count + 1;
}
function EditEntry(num) {
CurrentTrId = num; // Save Old TR ID
var idx = 0;
while((idx < QosList.length) && (QosList[idx].idx != num)) idx++;
var f = document.forms[0];
var category = QosList[idx].cate;
var selValue = QosList[idx].val;
sel_qos_category(category);
if((category == 0 && selValue == 0) || (category == 1 && selValue == 0)) DisplayNewRow(0);
f.qos_category.value = category;
f.qos_priority.value = QosList[idx].pri;
f.qos_category.disabled = 1;
update_selected(f.qos_category);
switch (category) {
case "0":
f.qos_applications.disabled = 1;
f.qos_applications.value = selValue;
update_selected(f.qos_applications);
if(selValue == 0) {
f.qos_enter_name_value.value = QosList[idx].name;
f.qos_fport1_value.value = QosList[idx].infor[0];
f.qos_tport1_value.value = QosList[idx].infor[1];
f.qos_pro1.value = QosList[idx].infor[2];
update_selected(f.qos_pro1);
if(QosList[idx].infor[3] != 0) f.qos_fport2_value.value = QosList[idx].infor[3];
if(QosList[idx].infor[4] != 0) f.qos_tport2_value.value = QosList[idx].infor[4];
f.qos_pro2.value = QosList[idx].infor[5];
update_selected(f.qos_pro2);
if(QosList[idx].infor[6] != 0) f.qos_fport3_value.value = QosList[idx].infor[6];
if(QosList[idx].infor[7] != 0) f.qos_tport3_value.value = QosList[idx].infor[7];
f.qos_pro3.value = QosList[idx].infor[8];
update_selected(f.qos_pro3);
checkportrange();
}
break;
case "1":
f.qos_game.disabled = 1;
f.qos_game.value = selValue;
update_selected(f.qos_game);
if(selValue == 0) {
f.qos_enter_name_value.value = QosList[idx].name;
f.qos_fport1_value.value = QosList[idx].infor[0];
f.qos_tport1_value.value = QosList[idx].infor[1];
f.qos_pro1.value = QosList[idx].infor[2];
update_selected(f.qos_pro1);
if(QosList[idx].infor[3] != 0) f.qos_fport2_value.value = QosList[idx].infor[3];
if(QosList[idx].infor[4] != 0) f.qos_tport2_value.value = QosList[idx].infor[4];
f.qos_pro2.value = QosList[idx].infor[5];
update_selected(f.qos_pro2);
if(QosList[idx].infor[6] != 0) f.qos_fport3_value.value = QosList[idx].infor[6];
if(QosList[idx].infor[7] != 0) f.qos_tport3_value.value = QosList[idx].infor[7];
f.qos_pro3.value = QosList[idx].infor[8];
update_selected(f.qos_pro3);
checkportrange();
}
break;
case "2":
case "3": //2006/3/20
f.qos_enter_name_value.value = QosList[idx].name;
f.qos_mac_address_value.value = QosList[idx].infor;
f.qos_voice_priority.value = QosList[idx].pri;
break;
default:
alert(L.common.fail_title);
}
}
function showSummary() {
var selectedCate = document.forms[0].qos_category.value;
var f = document.forms[0];
var data;
var qos_cnt = QosList.length;
if(qos_cnt >= 15) return;
if(checkValid(selectedCate) == false) return;
if(modifyQosEntry(selectedCate) == false) return;
if(document.forms[0].qos_category.disabled == 1) { //Edit
reDrawList();
}
else reDrawList();
resetElement();
}
function rate_grey(num, F)
{
var sw_disabled = (num == F.qos_upstream_bandwidth[0].value) ? true : false;
var bgcolor = (num == F.qos_upstream_bandwidth[0].value) ? "#E7E7E7" : "#FFFFFF";
F.qos_ub_value.disabled = sw_disabled;
F.qos_ub_value.style.backgroundColor = bgcolor;
F.qos_kbps_mbps.disabled = sw_disabled;
F.qos_kbps_mbps.style.backgroundColor = bgcolor;
update_selected(F.qos_kbps_mbps);
}
function sel_qos_iap(enable){
checkbox_switch('qos_internet_access_priority', enable)
}
function sel_qos_wmm(enable){
checkbox_switch('qos_wmm_support', enable)
}
function sel_qos_no_ack(enable){
checkbox_switch('qos_no_ack', enable)
}
function SetQos() {
var F = document.forms[0];
var flag;
if(F.qos_internet_access_priority.checked == true) {
flag = 0;
rate_grey(1, F);
F.qos_upstream_bandwidth.style.backgroundColor = "#FFFFFF";
F.qos_category.style.backgroundColor = "#FFFFFF";
F.qos_applications.style.backgroundColor = "#FFFFFF";
F.qos_priority.style.backgroundColor = "#FFFFFF";
F.qos_voice_priority.style.backgroundColor = "#FFFFFF";
} else {
flag = 1;
rate_grey(0, F);
F.qos_upstream_bandwidth.style.backgroundColor = "#E7E7E7";
F.qos_category.style.backgroundColor = "#E7E7E7";
F.qos_applications.style.backgroundColor = "#E7E7E7";
F.qos_priority.style.backgroundColor = "#E7E7E7";
F.qos_voice_priority.style.backgroundColor = "#E7E7E7";
}
F.qos_upstream_bandwidth.disabled = flag;
F.qos_category.disabled = flag;
F.qos_applications.disabled = flag;
F.qos_priority.disabled = flag;
F.btnApply.disabled = flag;
F.qos_game.disabled = flag;
F.qos_enter_name_value.disabled = flag;
F.qos_mac_address_value.disabled = flag;
//F.Ethernet.disabled = flag;
F.qos_voice_priority.disabled = flag;
update_selected(F.qos_upstream_bandwidth);
update_selected(F.qos_kbps_mbps);
update_selected(F.qos_category);
update_selected(F.qos_applications);
update_selected(F.qos_game);
//update_selected(F.Ethernet);
update_selected(F.qos_priority);
update_selected(F.qos_voice_priority);
}
function addtoSummary(idx) {
var tbody = document.getElementById("tabSummary");
var row = document.createElement("tr");
var tdArray = new Array();
var str = "",
data;
row.setAttribute("id", idx);
for(i = 0; i < 5; i++) {
tdArray[i] = document.createElement("td");
tdArray[i].style.cssText = 'text-align: center';
}

tdArray[0].innerHTML = value2string("pri", QosList[idx].pri);
if(QosList[idx].val == 0 || QosList[idx].cate==3 || QosList[idx].cate==2){
data = QosList[idx].name;
}
else {
data = value2string(QosList[idx].cate, QosList[idx].val);
}

tdArray[1].innerHTML = string_break(18, data);
if(QosList[idx].infor == "none") //2006/3/20
tdArray[2].innerHTML = "---";
else {
if(QosList[idx].cate == "2" || QosList[idx].cate == "3") str = "MAC " + QosList[idx].infor;
else {
str = "Port <br />" + QosList[idx].infor[0] + " - " + QosList[idx].infor[1];
if(QosList[idx].infor[3] > 0) str += "<br />" + QosList[idx].infor[3] + " - " + QosList[idx].infor[4];
if(QosList[idx].infor[6] > 0) str += "<br />" + QosList[idx].infor[6] + " - " + QosList[idx].infor[7];
}
tdArray[2].innerHTML = str;
tdArray[4].innerHTML = '<button  class="btn" type="button" onclick="EditEntry(' + idx + ')">'+L.common.btnEdit+'</button>';
}
tdArray[3].innerHTML = '<button class="btn" type="button" onclick="delRow(' + idx + ')">'+L.common.btnRemove+'</button>';

for(i = 0; i < 5; i++) row.appendChild(tdArray[i]);
tbody.appendChild(row);
if(ns4 == true || ns6 == true) {
var baseheight = 27;
if((QosList[idx].cate == "9" || QosList[idx].cate == "1") && QosList[idx].val == 0) {
if(QosList[idx].infor[3] != "0") baseheight += 12;
if(QosList[idx].infor[6] != "0") baseheight += 12;
}
}
}
function reDrawList()
{
var tbody = document.getElementById("tabSummary");
for(var i = tbody.children.length; i > 0; i--) tbody.removeChild(tbody.children[i - 1]);
for(var i = 0; i < QosList.length; i++) addtoSummary(i);
}
function DisplayNewRow(flag) {
var tmp = "none";
if(flag == 0) {
tmp = ""; //add new app
}
else {}
document.getElementById('tr_qos_enter_name').style.display = tmp;
document.getElementById('tr_qos_range').style.display = tmp;
}
function value2string(cate, idx) {
switch (cate) {
case "0":
flag = 0;
break;
case "1":
flag = 1;
break;
case "4":
flag = 2;
break;
default:
flag = 3;
break;
}
var cateArray = new Array();
cateArray[0] = new Array("", "MSN Messenger", "Skype", "Yahoo Message", "Windows Live Messenger", "AIM", "Windows Media Player", "RealPlayer", "QuickTime", "iTunes", "Yahoo Music Jukebox", "Rhapsody");
cateArray[1] = new Array("", "Neverwinter Nights 2", "Enemy Territory", "World In Conflict", "Call of Duty 4", "Sins of A Solar Empire", "Half-Life 2:The Orange Box", "Crysis", "Frontlines", "Warhammer 40,000:Dawn of War:Soulstorm", "S.T.A.L.K.E.R.:Shadow Of Chernoby", "World Of Warcraft", "Supreme Commander", "Titan Quest: Immortal Throne", "Battle field 2142", "Half-Life 2: Episode 1", "Heroes of Might & Magic V", "Guild Wars Factions I & II");
cateArray[2] = new Array("", "Ethernet Port 1", "Ethernet Port 2", "Ethernet Port 3", "Ethernet Port 4");
/*cateArray[3] = new Array("Low","Normal","Medium","High");*/
cateArray[3] = new Array("Low","Normal","Medium","High");
return (cateArray[flag][idx]);
}
function string_break(len,src)
{
var line = parseInt(src.length/len) ;
var i ,dst="" ;
if ( line == 0 ) return src;
if ( parseInt(src%len) != 0 ) line ++ ;
for(i=0; i<line; i++)
{
dst = dst + src.substring(0,len)+"<BR>";
src = src.substring(len,src.length);
}
return dst ;
}
function delRow(idx) {
delArrayElement(idx);
reDrawList();
/*
if( ns4 == true || ns6 == true) {
}
*/
document.forms[0].qos_category.disabled = false; //Add 2010-02-04
update_selected(document.forms[0].qos_category);
document.forms[0].qos_applications.disabled = false; //Add 2010-02-09
update_selected(document.forms[0].qos_applications);
document.forms[0].qos_game.disabled = false; //Add 2010-02-09
update_selected(document.forms[0].qos_game);
}
function delArrayElement(idx) {
var list = [];
var list2 = [];
for(var i = 0; i < QosList.length; i++){
if(idx != i) {
list.push(QosList[i]);
list2.push(tmpQosList[i]);
}
}
QosList = list;
tmpQosList = list2;
}
function sel_qos_category(category){
if(typeof(category) == "undefined"){
category = $("#qos_category").val()
}else{
$("#qos_category").val(category);
}

eval('var dy_id="L.security_qos.'+$("#qos_category option:selected").attr("id")+'"')
$("#qos_category").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
//var imgHeight = new Array("", "81", "81", "106", "81", "106");
document.getElementById('qos_mac_msg').innerHTML = "";
document.getElementById('tr_qos_applications').style.display = "none";
document.getElementById('tr_qos_game').style.display = "none";
document.getElementById('tr_qos_enter_name').style.display = "none";
document.getElementById('tr_qos_mac_address').style.display = "none";
//document.getElementById('trEth').style.display = "none";
document.getElementById('tr_qos_range').style.display = "none";
document.getElementById('tr_qos_priority').style.display = "none";
document.getElementById('tr_qos_voice_priority').style.display = "none";
document.getElementById('tr_qos_apply_button').style.display = "none";
document.forms[0].qos_priority.value = 2;
switch (category) {
case "0":
document.forms[0].qos_applications.value = 1;
document.forms[0].qos_enter_name_value.value = "";
document.forms[0].qos_fport1_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport1_value.value = ""; //Add 2010-02-10
document.forms[0].qos_fport2_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport2_value.value = ""; //Add 2010-02-10
document.forms[0].qos_fport3_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport3_value.value = ""; //Add 2010-02-10
sel_qos_pro1('1');
sel_qos_pro2('1');
sel_qos_pro3('1');
document.getElementById('tr_qos_applications').style.display = "";
document.getElementById('tr_qos_priority').style.display = "";
break;
case "1":
document.forms[0].qos_game.value = 1;
document.forms[0].qos_enter_name_value.value = "";
document.forms[0].qos_fport1_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport1_value.value = ""; //Add 2010-02-10
document.forms[0].qos_fport2_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport2_value.value = ""; //Add 2010-02-10
document.forms[0].qos_fport3_value.value = ""; //Add 2010-02-10
document.forms[0].qos_tport3_value.value = ""; //Add 2010-02-10
sel_qos_pro1('1');
sel_qos_pro2('1');
sel_qos_pro3('1');
document.getElementById('tr_qos_game').style.display = "";
document.getElementById('tr_qos_priority').style.display = "";
break;
case "2":
document.forms[0].qos_enter_name_value.value = "";
document.forms[0].qos_mac_address_value.value = "00:00:00:00:00:00"; //Add 2010-02-04
document.getElementById('qos_mac_msg').innerHTML = "&nbsp;" + L.security_qos.lang_qos_my_current_pcs_mac_address + " <b>"+macs+"</b>";
document.getElementById('tr_qos_enter_name').style.display = "";
document.getElementById('tr_qos_mac_address').style.display = "";
document.getElementById('tr_qos_priority').style.display = "";
break;
case "4":
//document.forms[0].Ethernet.value = 1;
//document.getElementById('trEth').style.display = "";
document.getElementById('tr_qos_priority').style.display = "";
break;
case "3":
document.forms[0].qos_voice_priority.value = 3;
document.forms[0].qos_enter_name_value.value = "";
document.forms[0].qos_mac_address_value.value = "00:00:00:00:00:00"; //Add 2010-02-04
document.getElementById('tr_qos_enter_name').style.display = "";
document.getElementById('tr_qos_mac_address').style.display = "";
document.getElementById('tr_qos_voice_priority').style.display = "";
break;
default:
alert(L.common.fail_title);
break;
}
document.getElementById('tr_qos_apply_button').style.display = "";
}
function valid_macs_all(I) {
var default_mac_address;
if(document.forms[0].qos_category.disabled == 1) {
default_mac_address=QosList[CurrentTrId].infor;
}else{
default_mac_address="00:00:00:00:00:00";
}

if (I.value == "") {
I.value = default_mac_address;
return true;
}
else if (I.value.length == 17){
if(valid_mac_17(I)==false){
I.value = default_mac_address;
}
}else {
alert(L.error_message.lang_error_message_err5);
I.value = default_mac_address;
}
}
function sel_qos_applications(mode){
if(typeof(mode) == "undefined"){
mode = $("#qos_applications").val()
}else{
$("#qos_applications").val(mode);
}
eval('var dy_id="L.security_qos.'+$("#qos_applications option:selected").attr("id")+'"')
$("#qos_applications").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}
function sel_qos_game(mode){
if(typeof(mode) == "undefined"){
mode = $("#qos_game").val()
}else{
$("#qos_game").val(mode);
}
eval('var dy_id="L.security_qos.'+$("#qos_game option:selected").attr("id")+'"')
$("#qos_game").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}
function sel_qos_priority(mode){
if(typeof(mode) == "undefined"){
mode = $("#qos_priority").val()
}else{
$("#qos_priority").val(mode);
}
eval('var dy_id="L.security_qos.'+$("#qos_priority option:selected").attr("id")+'"')
$("#qos_priority").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}
function sel_qos_voice_priority(mode){
if(typeof(mode) == "undefined"){
mode = $("#qos_voice_priority").val()
}else{
$("#qos_voice_priority").val(mode);
}
eval('var dy_id="L.security_qos.'+$("#qos_voice_priority option:selected").attr("id")+'"')
$("#qos_voice_priority").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}
function sel_qos_pro1(mode){
if(typeof(mode) == "undefined"){
mode = $("#qos_pro1").val()
}else{
$("#qos_pro1").val(mode);
}
eval('var dy_id="L.security_qos.'+$("#qos_pro1 option:selected").attr("id")+'"')
$("#qos_pro1").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}
function sel_qos_pro2(mode){
if(typeof(mode) == "undefined"){
mode = $("#qos_pro2").val()
}else{
$("#qos_pro2").val(mode);
}
eval('var dy_id="L.security_qos.'+$("#qos_pro2 option:selected").attr("id")+'"')
$("#qos_pro2").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}
function sel_qos_pro3(mode){
if(typeof(mode) == "undefined"){
mode = $("#qos_pro3").val()
}else{
$("#qos_pro3").val(mode);
}
eval('var dy_id="L.security_qos.'+$("#qos_pro3 option:selected").attr("id")+'"')
$("#qos_pro3").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}
function set_obj_success_cb(obj) {
if(obj.api_return != 0){
set_obj_error_cb(obj)
return;
}
$("#loader").hide()
show_alert(L.common.success_title, L.common.save_success)
page_initial();
}
function set_obj_error_cb(obj) {
$("#loader").hide()
if(obj.api_return == 403){
logout('sto')
return;
}else{
show_alert(L.common.fail_title, L.common.save_fail)
}
}
function set_obj_data(obj_content){
if(typeof(obj_content) == 'string')
API.obj.set(JSON.parse(obj_content), set_obj_success_cb, set_obj_error_cb);
else if(typeof(obj_content) == 'object')
API.obj.set(obj_content, set_obj_success_cb, set_obj_error_cb);
}
function page_save(fake_action){
//Coding save function here
$("#loader").show()
MODIFIED_OBJ_DATA.qos.QosP.wmmEnable= $("#qos_wmm_support").prop("checked")?"1":"0";
MODIFIED_OBJ_DATA.qos.QosP.wmmNoAckEnable= $("#qos_no_ack").prop("checked")?"1":"0";
MODIFIED_OBJ_DATA.qos.QosP.enable = $("#qos_internet_access_priority").prop("checked")?"1":"0";
MODIFIED_OBJ_DATA.qos.QosP.wanRateMode = $("#qos_upstream_bandwidth").val();
MODIFIED_OBJ_DATA.qos.QosP.wanRateUnitType = $("#qos_kbps_mbps").val();
if($("#qos_upstream_bandwidth").val()==1){
if($("#qos_kbps_mbps").val()==1){
if(valid_range(document.getElementById("qos_ub_value"),1,70,'lang_err_range')==false){
$("#loader").hide();
return ;
}
MODIFIED_OBJ_DATA.qos.QosP.wanRateMbps=$("#qos_ub_value").val();
}else{
if(valid_range(document.getElementById("qos_ub_value"),128,71680,'lang_err_range')==false){
$("#loader").hide();
return ;
}
MODIFIED_OBJ_DATA.qos.QosP.wanRateKbps=$("#qos_ub_value").val();
}
}
MODIFIED_OBJ_DATA.qosPolicy.QosPolicyT=tmpQosList;

if (fake_action == true){
$("#loader").hide();
return;
}
//alert(JSON.stringify(MODIFIED_OBJ_DATA));
set_obj_data(MODIFIED_OBJ_DATA)
}
function page_cancel(){
page_initial();
//Coding cancel function here
}
function get_obj_success_cb(obj) {

ORIGINAL_OBJ_DATA = API.obj.copy(obj);
MODIFIED_OBJ_DATA = API.obj.copy(ORIGINAL_OBJ_DATA);

sel_qos_iap(MODIFIED_OBJ_DATA.qos.QosP.enable)
sel_qos_wmm(MODIFIED_OBJ_DATA.qos.QosP.wmmEnable)
sel_qos_no_ack(MODIFIED_OBJ_DATA.qos.QosP.wmmNoAckEnable)
if(document.forms[0].qos_wmm_support)
SelWME(document.forms[0], '');
SetQos();

$("#qos_upstream_bandwidth").val(MODIFIED_OBJ_DATA.qos.QosP.wanRateMode)
$("#qos_kbps_mbps").val(MODIFIED_OBJ_DATA.qos.QosP.wanRateUnitType)
sel_qos_upstream_bandwidth(MODIFIED_OBJ_DATA.qos.QosP.wanRateMode)
//rate_grey(MODIFIED_OBJ_DATA.qos.QosP.wanRateMode,document.forms[0])
sel_qos_kbps_mbps(MODIFIED_OBJ_DATA.qos.QosP.wanRateUnitType)
if(MODIFIED_OBJ_DATA.qos.QosP.wanRateUnitType==1){
$("#qos_ub_value").val(MODIFIED_OBJ_DATA.qos.QosP.wanRateMbps);
}else{
$("#qos_ub_value").val(MODIFIED_OBJ_DATA.qos.QosP.wanRateKbps);
}

var i;
if(typeof(INFO_DATA.dhcpClientT)!="undefined"){
for (i=0; i < INFO_DATA.dhcpClientT.length; i++) {
if (INFO_DATA.dhcpClientT[i].assignedIp == login_ip) {
macs = INFO_DATA.dhcpClientT[i].mac;
break;
}
}
}

/*
MODIFIED_OBJ_DATA={"qos":{"QosP":{"enable":"1","wmmEnable":"1","wmmNoAckEnable":"1","wanRateMode":"1","wanRateUnitType":"1","wanRateKbps":"0","wanRateMbps":"123"}},"qosPolicy":{"QosPolicyT":[{"category":"0","serviceName":"MSN Messenger","priority":"2","deviceMac":"","servicePortStart1":"","servicePortEnd1":"","serviceProto1":"","servicePortStart2":"","servicePortEnd2":"","serviceProto2":"","servicePortStart3":"","servicePortEnd3":"","serviceProto3":""}]}}
*/
var idx=0;
MODIFIED_OBJ_DATA.qosPolicy.QosPolicyT.forEach(function(element) {
//fix selvalue
if(element.category==0){
var selValue="0";
for(i=0;i<app_name.length;i++){
if(element.serviceName==app_mapping[i]){
selValue=i+1;
}
}
}else if(element.category==1){
var selValue="0";
for(i=0;i<game_name.length;i++){
if(element.serviceName==game_mapping[i]){
selValue=i+1;
}
}
}
//fix infor
var infor;
var rangeArray = new Array("0", "0", "0", "0", "0", "0", "0", "0", "0");
if(element.category==0||element.category==1){
if(selValue==0){
rangeArray[0]=element.servicePortStart1;
rangeArray[1]=element.servicePortEnd1;
rangeArray[2]=element.serviceProto1;
rangeArray[3]=element.servicePortStart2;
rangeArray[4]=element.servicePortEnd2
rangeArray[5]=element.serviceProto2;
rangeArray[6]=element.servicePortStart3;
rangeArray[7]=element.servicePortEnd3;
rangeArray[8]=element.serviceProto3;
infor = rangeArray;
}else{
infor="none";
}
}else if(element.category==2||element.category==3){
infor=element.deviceMac;
}

QosList[idx] = new QosEntry(idx, element.category, selValue, element.serviceName, element.priority, infor);
tmpQosList[idx] = new tmpQosEntry(idx, element.category, selValue, element.serviceName, element.priority, infor);
idx++;
});
reDrawList();
ORIGINAL_OBJ_DATA.qosPolicy.QosPolicyT=tmpQosList;
}
function get_obj_error_cb(obj) {
//console.log(obj)
}
function get_obj_data(obj_list){
API.obj.get(obj_list, get_obj_success_cb, get_obj_error_cb);
}

function get_info_success_cb(obj) {
login_ip = obj.LOGINIP;
INFO_DATA = API.obj.copy(obj);
get_obj_data(OBJ_LIST);
}
function get_info_error_cb(obj) {
if (obj.api_return == 403) {
logout('sto')
}
}
function get_info_data(info_list) {
API.info.get(info_list, get_info_success_cb, get_info_error_cb);
}

function page_initial(){
//Coding initial function here
get_info_data(INFO_LIST);
//get_obj_data(OBJ_LIST)
sel_qos_category('0')
sel_qos_applications('1')
sel_qos_game('1')
sel_qos_priority('2')
sel_qos_voice_priority('0')
sel_qos_pro1('1')
sel_qos_pro2('1')
sel_qos_pro3('1')

//SetQos()
}

function escape_modified_check() {
page_save(true);
if (UI.obj.cmp(MODIFIED_OBJ_DATA,ORIGINAL_OBJ_DATA))
return false;
else
return true;
}
</script>
