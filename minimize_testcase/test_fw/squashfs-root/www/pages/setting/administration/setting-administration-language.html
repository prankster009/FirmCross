<script type="text/javascript">
var OBJ_LIST = ['system']
var ORIGINAL_OBJ_DATA = {}
var MODIFIED_OBJ_DATA = {}
var lang_str_list = ['language_select_tw','language_select_cn','language_select_en','language_select_th','language_select_kr','language_select_jp','language_select_vn','language_select_ca']
var lang_val_list = ['tw','cn','en','th','kr','jp','vn','ca']
</script>
<table class="table table-info language_zone">
<tbody>
<tr id="tr_language" >
<td>
<span class="multi_lang" id="lang_language_title"></span>
</td>
<td id="select_td">
<script>(function(){draw_select('language', lang_str_list, lang_val_list,'sel_lang()', '');})();</script>
<div id="select_div_language"></div>
</td>
</tr>
</tbody>
</table>
<div class="form-actions">
<button class="btn btn-primary multi_lang logger_bot" id="btnSave" type="button" name="" onclick="page_save()"></button>
<button class="btncancel multi_lang logger_bot" id="btnCancel" type="button" name="" onclick="page_cancel()"></button>
</div>
<script language="javascript" type="text/javascript">
page_tag='administration_language'
var SVAE_RD_FLAG=0

$(document).ready(function(){
$.lang_load("administration_language");
page_initial()
inject_log_bot()
escape_detection()

//Disabled language dropdown list because multiple language file not ready yet
//$("#language").attr('disabled', true);
});
function sel_lang(lang){
if(typeof(lang) == "undefined")
lang = $("#language").val()
else
$("#language").val(lang)

if ( 'undefined' == typeof(L.administration_language) ){
setTimeout(function(){
eval('var dy_id="L.administration_language.'+$("#language option:selected").attr("id")+'"')
$("#language").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
},1500)
}else{
eval('var dy_id="L.administration_language.'+$("#language option:selected").attr("id")+'"')
$("#language").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}
}

function get_obj_success_cb(obj) {
if(obj.api_return != 0){
get_obj_error_cb(obj)
return;
}
ORIGINAL_OBJ_DATA = API.obj.copy(obj);
MODIFIED_OBJ_DATA = API.obj.copy(ORIGINAL_OBJ_DATA);
sel_lang(MODIFIED_OBJ_DATA.system.SystemP.language)
}
function get_obj_error_cb(obj) {
if(obj.api_return == 403){
logout('sto')
return;
}else if(obj.api_return == 1){
sel_lang('en')
}
}
function get_obj_data(obj_list){
API.obj.get(obj_list, get_obj_success_cb, get_obj_error_cb);
}

function set_obj_success_cb(obj){
if(obj.api_return != 0){
set_obj_error_cb(obj)
return;
}

SVAE_RD_FLAG=1
localStorage.lang=$("#language").val()
localStorage.rd=["setting", "administration", "#submenu_setting_administration_language .submenu-link",'setting/administration/setting-administration-language.html','lang_submenu_setting_administration_language']

setTimeout(function(){
$("#loader").hide()
show_alert(L.common.success_title, L.common.save_success)
setTimeout(function(){
window.location.replace("setting.html");
},500)
},2000)
}

function set_obj_error_cb(obj) {
$("#loader").hide()
if(obj.api_return == 403){
logout('sto')
return;
}else{
show_alert(L.common.fail_title, L.common.save_fail)
}
}

function set_obj_data(obj_content){
if(typeof(obj_content) == 'string')
API.obj.set(JSON.parse(obj_content), set_obj_success_cb, set_obj_error_cb);
else if(typeof(obj_content) == 'object')
API.obj.set(obj_content, set_obj_success_cb, set_obj_error_cb);
}

function page_save(fake_action){
MODIFIED_OBJ_DATA.system.SystemP.language = $("#language").val()
if( 'undefined' == typeof(fake_action) || !fake_action){
$("#loader").show()
set_obj_data(MODIFIED_OBJ_DATA)
}
}
function page_cancel(){
page_initial()
}

function page_initial(){
get_obj_data(OBJ_LIST)
}

function escape_modified_check(){
if(SVAE_RD_FLAG == 1){
return false
}else{
page_save(true)
if(UI.obj.cmp(MODIFIED_OBJ_DATA,ORIGINAL_OBJ_DATA))
return false
else
return true
}

}
</script>

