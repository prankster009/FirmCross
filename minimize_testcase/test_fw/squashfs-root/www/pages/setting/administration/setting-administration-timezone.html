<script type="text/javascript">
var OBJ_LIST = ['timeZone','easyMeshBasic']
var ORIGINAL_OBJ_DATA = {}
var MODIFIED_OBJ_DATA = {}
var tz_str_list = ['tz_kwajalein','tz_midway','tz_hawaii','tz_alaska','tz_pacific','tz_arizona','tz_mountain','tz_mexico','tz_central','tz_indiana','tz_eastern','tz_bolivia','tz_atlantic','tz_guyana','tz_newfoundland','tz_brazil','tz_mid','tz_azores','tz_gambia','tz_england','tz_tunisia','tz_france','tz_south','tz_greece','tz_iraq','tz_armenia','tz_pakistan','tz_india','tz_bangladesh','tz_thailand','tz_china','tz_singapore','tz_japan','tz_guam','tz_australia','tz_solomon','tz_fiji','tz_new_zealand']
var tz_val_list = lswf_tz_val_list
</script>
<table class="table table-info timezone_zone">
<tbody>
<tr id="tr_timezone" >
<td>
<span class="multi_lang" id="lang_timezone_title"></span>
</td>
<td id="select_td">
<script>(function(){draw_select('timezone', tz_str_list, tz_val_list,'sel_tz()', '');})();</script>
<div id="select_div_timezone"></div>
</td>
</tr>
<tr id="tr_daylight_saveing" >
<td colspan=2><script>draw_checkbox('daylight_saveing', 'lang_daylight_saveing_title', '', "daylight_control()");</script><span id="checkbox_div_daylight_saveing"></span>
</td>
</tr>
</tbody>
</table>
<div class="form-actions">
<button class="btn btn-primary multi_lang logger_bot" id="btnSave" type="button" name="" onclick="page_save()"></button>
<button class="btncancel multi_lang logger_bot" id="btnCancel" type="button" name="" onclick="page_cancel()"></button>
</div>
<script language="javascript" type="text/javascript">

page_tag='administration_timezone'
$(document).ready(function(){
$.lang_load("administration_timezone");
page_initial()
inject_log_bot()
escape_detection()
});

var ORI_ZONE_NAME = ""
var ORI_DLS

function set_obj_success_cb(obj) {
if(obj.api_return != 0){
set_obj_error_cb(obj)
return;
}
$("#loader").hide()
show_alert(L.common.success_title, L.common.save_success)
ORIGINAL_OBJ_DATA.timeZone.TimeZoneP.zonename = MODIFIED_OBJ_DATA.timeZone.TimeZoneP.zonename
pre_sel_tz(ORIGINAL_OBJ_DATA.timeZone.TimeZoneP.zonename)
}
function set_obj_error_cb(obj) {
$("#loader").hide()
if(obj.api_return == 403){
logout('sto')
return;
}else{
show_alert(L.common.fail_title, L.common.save_fail)
}
}
function set_obj_data(obj_content){
if(typeof(obj_content) == 'string')
API.obj.set(JSON.parse(obj_content), set_obj_success_cb, set_obj_error_cb);
else if(typeof(obj_content) == 'object')
API.obj.set(obj_content, set_obj_success_cb, set_obj_error_cb);
}
function page_save(fake_action){
if( 'undefined' == typeof(fake_action) || !fake_action){
$("#loader").show()
set_obj_data(MODIFIED_OBJ_DATA)
}
}

function pre_sel_tz(tz_data){
var tz_val = tz_data

tz_data_t = tz_val.split("_");
if(tz_data_t[3] == "1"){
tz_val = tz_data_t[0]+'_'+tz_data_t[1]+'_'+tz_data_t[2]+'_'+tz_data_t[3]+'_'+'1'+'_'+tz_data_t[5]
}
ORI_ZONE_NAME = tz_data_t[5]

var dls = parseInt(tz_data_t[4], 10);
ORI_DLS = dls
sel_tz(tz_val, dls)
}

function page_cancel(){
pre_sel_tz(ORIGINAL_OBJ_DATA.timeZone.TimeZoneP.zonename)
}
function get_obj_success_cb(obj) {
if(obj.api_return != 0){
get_obj_error_cb(obj)
return;
}
ORIGINAL_OBJ_DATA = API.obj.copy(obj);
MODIFIED_OBJ_DATA = API.obj.copy(ORIGINAL_OBJ_DATA);
if( 'undefined' != typeof(MODIFIED_OBJ_DATA.timeZone.TimeZoneP.zonename) && "" != MODIFIED_OBJ_DATA.timeZone.TimeZoneP.zonename){
pre_sel_tz(MODIFIED_OBJ_DATA.timeZone.TimeZoneP.zonename)
}
else
pre_sel_tz('utc_m_12-0_0_0_kwajalein')
if(MODIFIED_OBJ_DATA.easyMeshBasic.EasyMeshBasicP.deviceRole=='2' && MODIFIED_OBJ_DATA.easyMeshBasic.EasyMeshBasicP.enable=='1'){
$("#timezone").attr('disabled', true);
$("#daylight_saveing").attr('disabled', true);
}
}
function get_obj_error_cb(obj) {
if(obj.api_return == 403){
logout('sto')
return;
}
}
function get_obj_data(obj_list){
API.obj.get(obj_list, get_obj_success_cb, get_obj_error_cb);
}
function page_initial(){
get_obj_data(OBJ_LIST)
}

function daylight_control(enable){
enable = checkbox_switch('daylight_saveing', enable)
tz_data = MODIFIED_OBJ_DATA.timeZone.TimeZoneP.zonename.split("_");
MODIFIED_OBJ_DATA.timeZone.TimeZoneP.zonename = tz_data[0]+'_'+tz_data[1]+'_'+tz_data[2]+'_'+tz_data[3]+'_'+enable+'_'+tz_data[5]
}

function daylight_layout_control(on, dls){
if( on == 0 ){
$("#daylight_saveing").attr('disabled', true);
daylight_control(0)
}else{
$("#daylight_saveing").attr('disabled', false);
if( 'undefined' == typeof(dls) || (dls != 0 && dls != 1) )
daylight_control(1)
else{
daylight_control(dls)
}
}
}

function sel_tz(tz, dls){
if(typeof(tz) == "undefined")
tz = $("#timezone").val()
else
$("#timezone").val(tz)

MODIFIED_OBJ_DATA.timeZone.TimeZoneP.zonename = tz
eval('var dy_id="L.administration_timezone.'+$("#timezone option:selected").attr("id")+'"')
$("#timezone").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");

tz_data_t = tz.split("_");

if( typeof(dls) == "undefined" && tz_data_t[5] == ORI_ZONE_NAME )
dls = ORI_DLS

dls_enable = tz_data_t[3];
daylight_layout_control(dls_enable, dls);
}

function escape_modified_check(){
page_save(true)
if(UI.obj.cmp(MODIFIED_OBJ_DATA,ORIGINAL_OBJ_DATA))
return false
else
return true
}

</script>

