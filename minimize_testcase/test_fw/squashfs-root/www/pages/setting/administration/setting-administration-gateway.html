<script type="text/javascript">
var OBJ_LIST = ['alg','upnp']
var ORIGINAL_OBJ_DATA = {}
var MODIFIED_OBJ_DATA = {}
</script>
<table class="table table-info sip_alg_zone">
<tbody>
<tr id="tr_sip_alg" >
<td><script>draw_checkbox('sip_alg', 'lang_sip_alg_title', 'on', "sip_alg_control()");</script><span id="checkbox_div_sip_alg"></span>
</td>
<td>
<span >&nbsp;</span>
</td>
</tr>
</tbody>
</table>
<div class="table-title upnp_zone">
<span class="multi_lang" id="lang_gateway_zone_upnp_title"></span>
</div>
<hr class="table-title-underline upnp_zone">
<table class="table table-info upnp_zone">
<tbody>
<tr id="tr_upnp_enable" >
<td><script>draw_checkbox('upnp_enable', 'lang_upnp_enable_title', 'on', "upnp_enable_control()");</script><span id="checkbox_div_upnp_enable"></span>
</td>
</tr>
<tr id="tr_allow_config" >
<td><script>draw_checkbox('allow_config', 'lang_allow_config_title', 'on', "upnp_allow_config_control()");</script><span id="checkbox_div_allow_config"></span>
</td>
</tr>
<tr id="tr_allow_disable_net" >
<td><script>draw_checkbox('allow_disable_net', 'lang_allow_disable_net_title', 'on', "upnp_allow_disable_net_control()");</script><span id="checkbox_div_allow_disable_net"></span>
</td>
</tr>
</tbody>
</table>
<div class="form-actions">
<button class="btn btn-primary multi_lang logger_bot" id="btnSave" type="button" name="" onclick="page_save()"></button>
<button class="btncancel multi_lang logger_bot" id="btnCancel" type="button" name="" onclick="page_cancel()"></button>
</div>
<script language="javascript" type="text/javascript">

page_tag='administration_gateway'
$(document).ready(function(){
$.lang_load("administration_gateway");
page_initial()
inject_log_bot()
escape_detection()
});

function sip_alg_control(enable){
enable = checkbox_switch('sip_alg', enable)
MODIFIED_OBJ_DATA.alg.AlgP.sipAlgEnable = enable.toString()
}
function upnp_enable_control(enable){
enable = checkbox_switch('upnp_enable', enable)

if(enable == 1){
$("#allow_config").attr('disabled', false);
$("#allow_config").parent().removeClass('disabled')
$("#allow_disable_net").attr('disabled', false);
$("#allow_disable_net").parent().removeClass('disabled')
}else{
$("#allow_config").attr('disabled', true);
$("#allow_config").parent().addClass('disabled')
$("#allow_disable_net").attr('disabled', true);
$("#allow_disable_net").parent().addClass('disabled')
}
MODIFIED_OBJ_DATA.upnp.UpnpP.enable = enable.toString()
}
function upnp_allow_config_control(enable){
enable = checkbox_switch('allow_config', enable)
MODIFIED_OBJ_DATA.upnp.UpnpP.allowUserConf = enable.toString()
}
function upnp_allow_disable_net_control(enable){
enable = checkbox_switch('allow_disable_net', enable)
MODIFIED_OBJ_DATA.upnp.UpnpP.disableInternet = enable.toString()
}
function set_obj_success_cb(obj) {
if(obj.api_return != 0){
set_obj_error_cb(obj)
return;
}
$("#loader").hide()
show_alert(L.common.success_title, L.common.save_success)

ORIGINAL_OBJ_DATA = UI.obj.merge(MODIFIED_OBJ_DATA, ORIGINAL_OBJ_DATA);
}
function set_obj_error_cb(obj) {
$("#loader").hide()
if(obj.api_return == 403){
logout('sto')
return;
}else{
show_alert(L.common.fail_title, L.common.save_fail)
}
}
function set_obj_data(obj_content){
if(typeof(obj_content) == 'string')
API.obj.set(JSON.parse(obj_content), set_obj_success_cb, set_obj_error_cb);
else if(typeof(obj_content) == 'object')
API.obj.set(obj_content, set_obj_success_cb, set_obj_error_cb);
}
function page_save(fake_action){
if( 'undefined' == typeof(fake_action) || !fake_action){
$("#loader").show()
set_obj_data(MODIFIED_OBJ_DATA)
}
}
function page_cancel(){
update_layout(ORIGINAL_OBJ_DATA)
}
function update_layout(obj_data){
//SIP ALG
if(obj_data.firewall != "NOK" && typeof(obj_data.alg.AlgP.sipAlgEnable) != 'undefined'){
sip_alg_control(obj_data.alg.AlgP.sipAlgEnable)
}else
sip_alg_control(0)

//UPnP
if(obj_data.upnp != "NOK" && typeof(obj_data.upnp.UpnpP.enable) != 'undefined'){
upnp_enable_control(obj_data.upnp.UpnpP.enable)
}else
upnp_enable_control(0)

if(obj_data.upnp != "NOK" && typeof(obj_data.upnp.UpnpP.allowUserConf) != 'undefined'){
upnp_allow_config_control(obj_data.upnp.UpnpP.allowUserConf)
}else
upnp_allow_config_control(0)

if(obj_data.upnp != "NOK" && typeof(obj_data.upnp.UpnpP.disableInternet) != 'undefined'){
upnp_allow_disable_net_control(obj_data.upnp.UpnpP.disableInternet)
}else
upnp_allow_disable_net_control(0)
}
function get_obj_success_cb(obj) {
if(obj.api_return != 0){
get_obj_error_cb(obj)
return;
}
ORIGINAL_OBJ_DATA = API.obj.copy(obj);
MODIFIED_OBJ_DATA = API.obj.copy(ORIGINAL_OBJ_DATA);
update_layout(MODIFIED_OBJ_DATA)
}
function get_obj_error_cb(obj) {
if(obj.api_return == 403){
logout('sto')
return;
}
}
function get_obj_data(obj_list){
API.obj.get(obj_list, get_obj_success_cb, get_obj_error_cb);
}
function page_initial(){
get_obj_data(OBJ_LIST)
}

function escape_modified_check(){
page_save(true)
if(UI.obj.cmp(MODIFIED_OBJ_DATA,ORIGINAL_OBJ_DATA))
return false
else
return true
}
</script>

