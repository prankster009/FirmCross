<script type="text/javascript">
var OBJ_LIST = ['macClone','lan']
var ORIGINAL_OBJ_DATA = {}
var MODIFIED_OBJ_DATA = {}
var INFO_LIST = ['dhcpClientT'];
var INFO_DATA = {};
var INFO_SET = {"macClone":{"ip":"0.0.0.0"}};
var INFO_SET_DATA = {};
var http_from = 'lan';
var login_ip = "0.0.0.0";
var SAVE_MACCLONE_WAITING_TIME = 15000;
</script>
<form id='ui-form'>
<table class="table table-info mac_addr_clone_setting_zone">
<tbody>
<tr id="tr_mac_addr_clone_enable" >
<td><script>draw_checkbox('macClone.MacCloneP[enable]', 'lang_mac_addr_clone_enable_title', 'on', "mac_addr_clone_checked()");</script><span id="checkbox_div_macClone.MacCloneP[enable]"></span>
</td>
<td>
<span >&nbsp;</span>
</td>
</tr>
<tr id="tr_hr" >
<td colspan="2"><hr class="table-title-underline"></td>
</tr>
<tr id="tr_mac_addr_input" >
<td>
<span class="multi_lang" id="lang_mac_addr_input_title"></span>
</td>
<td>
<input type="hidden" name="macClone.MacCloneP[macAddress]" uisync="mac;mac_addr_input_0;mac_addr_input_1;mac_addr_input_2;mac_addr_input_3;mac_addr_input_4;mac_addr_input_5" class="logger_bot">
<input maxlength="2" value="" name="mac_addr_input_0" id="mac_addr_input_0" onblur="valid_mac(this,0)" size="2" class="logger_bot"> :
<input maxlength="2" value="" name="mac_addr_input_1" id="mac_addr_input_1" onblur="valid_mac(this,1)" size="2" class="logger_bot"> :
<input maxlength="2" value="" name="mac_addr_input_2" id="mac_addr_input_2" onblur="valid_mac(this,1)" size="2" class="logger_bot"> :
<input maxlength="2" value="" name="mac_addr_input_3" id="mac_addr_input_3" onblur="valid_mac(this,1)" size="2" class="logger_bot"> :
<input maxlength="2" value="" name="mac_addr_input_4" id="mac_addr_input_4" onblur="valid_mac(this,1)" size="2" class="logger_bot"> :
<input maxlength="2" value="" name="mac_addr_input_5" id="mac_addr_input_5" onblur="valid_mac(this,1)" size="2" class="logger_bot">
</td>
</tr>
<tr id="tr_mac_clone" >
<td>
<span >&nbsp;</span>
</td>
<td>
<button class="btn multi_lang logger_bot" type="button" name="" id="lang_mac_clone_button" onclick="mac_clone_click()"></button>
</td>
</tr>
</tbody>
</table>
</form>
<div class="form-actions">
<button class="btn btn-primary multi_lang logger_bot" id="btnSave" type="button" name="" onclick="page_save()"></button>
<button class="btncancel multi_lang logger_bot" id="btnCancel" type="button" name="" onclick="page_cancel()"></button>
</div>
<script type="text/javascript">
page_tag='connectivity_macclone'
$(document).ready(function(){
$.lang_load("connectivity_macclone");
$.lang_load("error_message");
page_initial()
inject_log_bot()
escape_detection();
});

function set_mac_clone_init(obj) {
var i,macs;
var setObj = UI.obj.copy(obj);

UI.obj.toForm(setObj, 'ui-form');

mac_addr_clone_checked();

macs = obj.macClone.MacCloneP.macAddress.split(":");
if (typeof(macs) != 'undefined' && macs.length == 6) {
for (i=0; i < macs.length; ++i)
$('#mac_addr_input_'+i).attr('value', macs[i]);
}
else {
for (i=0; i < macs.length; ++i)
$('#mac_addr_input_'+i).attr('value', '00');
}

// lan clone PC's MAC is not accessable from remote control
http_from = get_login_from(obj.lan.LanP,login_ip);
if (http_from == 'wan') {
$('#macClone\\.MacCloneP\\[enable\\]').attr("disabled", "true");
set_all_element_disable();
}

update_checked($('#macClone\\.MacCloneP\\[enable\\]').attr('name'));
}

function set_all_element_enable() {
$('[name^=mac_addr_input]').removeAttr("disabled");
$('#lang_mac_clone_button').removeAttr("disabled");
}

function set_all_element_disable() {
$('[name^=mac_addr_input]').attr("disabled", "true");
$('#lang_mac_clone_button').attr("disabled", "true");
}

function get_login_from(obj,ip) {
var lanip=obj.ipaddr.split(".");
var lanmask=obj.netmask.split(".");
var loginip=ip.split(".");

if (((lanip[0] & lanmask[0]) != (loginip[0] & lanmask[0])) ||
((lanip[1] & lanmask[1]) != (loginip[1] & lanmask[1])) ||
((lanip[2] & lanmask[2]) != (loginip[2] & lanmask[2])) ||
((lanip[3] & lanmask[3]) != (loginip[3] & lanmask[3])))
{
return 'wan';
}
return 'lan';
}

function mac_addr_clone_checked() {
if ($('#macClone\\.MacCloneP\\[enable\\]').prop('checked')) {
$('#macClone\\.MacCloneP\\[enable\\]').attr('value','1');
$('#macClone\\.MacCloneP\\[enable\\]').attr('checked','checked');
set_all_element_enable();

if (http_from != 'lan')
$('#lang_mac_clone_button').attr("disabled", "true");
}
else {
$('#macClone\\.MacCloneP\\[enable\\]').attr('value','0');
$('#macClone\\.MacCloneP\\[enable\\]').removeAttr('checked');
set_all_element_disable();
}
}

function mac_clone_click() {
var macs="";
var i;

macs = INFO_SET_DATA.macClone.mac;
if (typeof(macs) == 'undefined' || macs == "") {
for (i=0; i < INFO_DATA.dhcpClientT.length; ++i) {
if (INFO_DATA.dhcpClientT[i].assignedIp == login_ip) {
macs = INFO_DATA.dhcpClientT[i].mac;
break;
}
}
}

if (typeof(macs) != 'undefined' && macs != "") macs = macs.split(":");
else macs = ('00:00:00:00:00:00').split(":");

for (i=0; i < macs.length; ++i) {
$('#mac_addr_input_'+i).val(macs[i]);
$('#mac_addr_input_'+i).attr('value', macs[i]);
}
}

function valid_mac_all_0() {
if ($('#macClone\\.MacCloneP\\[enable\\]').prop('checked') == false)
return true;
else if ($('#mac_addr_input_0').val() == '00' &&
$('#mac_addr_input_1').val() == '00' &&
$('#mac_addr_input_2').val() == '00' &&
$('#mac_addr_input_3').val() == '00' &&
$('#mac_addr_input_4').val() == '00' &&
$('#mac_addr_input_5').val() == '00')
{
alert(L.error_message.lang_error_message_err17);
return false;
}

return true;
}

function escape_modified_check() {
page_save(true);
if (UI.obj.cmp(MODIFIED_OBJ_DATA,ORIGINAL_OBJ_DATA))
return false;
else
return true;
}

function set_obj_success_cb(obj) {
get_obj_data(OBJ_LIST);

setTimeout(function () {
$("#loader").hide();
show_alert(L.common.success_title, L.common.save_success);
},SAVE_MACCLONE_WAITING_TIME);
}
function set_obj_error_cb(obj) {
$("#loader").hide();
if (obj.api_return == 403) {
logout('sto')
}
else {
show_alert(L.common.fail_title, L.common.save_fail)
}
}
function set_obj_data(obj_content){
if(typeof(obj_content) == 'string')
API.obj.set(JSON.parse(obj_content), set_obj_success_cb, set_obj_error_cb);
else if(typeof(obj_content) == 'object')
API.obj.set(obj_content, set_obj_success_cb, set_obj_error_cb);
}
function page_save(fake_action){
var obj=UI.form.toObj('ui-form');

MODIFIED_OBJ_DATA = UI.obj.merge(MODIFIED_OBJ_DATA, obj);

if (valid_mac_all_0() == false) {
show_alert(L.common.fail_title, L.common.save_fail);
return;
}

if (fake_action == true) return;

if (JSON.stringify(MODIFIED_OBJ_DATA) == JSON.stringify(ORIGINAL_OBJ_DATA))
show_alert(L.common.lang_info_title, L.common.lang_config_not_change);
else {
$("#loader").show();
set_obj_data(MODIFIED_OBJ_DATA);
}
}
function page_cancel(){
//Coding cancel function here
MODIFIED_OBJ_DATA = API.obj.copy(ORIGINAL_OBJ_DATA);
set_mac_clone_init(ORIGINAL_OBJ_DATA);
}
function get_obj_success_cb(obj) {
ORIGINAL_OBJ_DATA = API.obj.copy(obj);
MODIFIED_OBJ_DATA = API.obj.copy(ORIGINAL_OBJ_DATA);

set_mac_clone_init(ORIGINAL_OBJ_DATA);
}
function get_obj_error_cb(obj) {
if (obj.api_return == 403) {
logout('sto')
}
}
function get_obj_data(obj_list){
API.obj.get(obj_list, get_obj_success_cb, get_obj_error_cb);
}
function set_info_success_cb(obj) {
INFO_SET_DATA = API.obj.copy(obj);
}
function set_info_error_cb(obj) {
if (obj.api_return == 403) {
logout('sto')
}
}
function set_info_data(obj_content){
if(typeof(obj_content) == 'string')
API.info.set(JSON.parse(obj_content), set_info_success_cb, set_info_error_cb);
else if(typeof(obj_content) == 'object')
API.info.set(obj_content, set_info_success_cb, set_info_error_cb);
}
function get_info_success_cb(obj) {
login_ip = obj.LOGINIP;
INFO_DATA = API.obj.copy(obj);

get_obj_data(OBJ_LIST);

INFO_SET.macClone.ip = obj.LOGINIP;
set_info_data(INFO_SET);
}
function get_info_error_cb(obj) {
if (obj.api_return == 403) {
logout('sto')
}
}
function get_info_data(info_list) {
API.info.get(info_list, get_info_success_cb, get_info_error_cb);
}
function page_initial(){
//Coding initial function here
get_info_data(INFO_LIST);
}

</script>

