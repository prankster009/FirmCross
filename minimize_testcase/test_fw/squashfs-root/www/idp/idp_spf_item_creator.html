<!DOCTYPE html>
<HTML >
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title></title>
<meta http-equiv="expires" content="0">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link rel="stylesheet" href="/css/all.min.css">
<script src="/js/all.min.js"></script>
<style>
body { display: initial }
.col-md-right { overflow: auto; float: none; height: auto }
body{
background-color: white;
display: block;
}
</style>
<script type="text/javascript">
var spf_app_str_list = ['app_manual', 'app_ftp', 'app_telnet', 'app_smtp', 'app_dns', 'app_tftp', 'app_finger', 'app_http', 'app_pop3', 'app_nntp', 'app_snmp', 'app_pptp']
var spf_app_val_list = ['manual', 'ftp', 'telnet', 'smtp', 'dns', 'tftp', 'finger', 'http', 'pop3', 'nntp', 'snmp', 'pptp']
var spf_pro_str_list = ['protocol_both', 'protocol_tcp', 'protocol_udp']
var spf_pro_val_list = ['both', 'tcp', 'udp']
var app_data = {"ftp":{"desc":"FTP","externalPort":"21","internalPort":"21","proto":"tcp"},
"telnet":{"desc":"Telnet","externalPort":"23","internalPort":"23","proto":"tcp"},
"smtp":{"desc":"SMTP","externalPort":"25","internalPort":"25","proto":"tcp"},
"dns":{"desc":"DNS","externalPort":"53","internalPort":"53","proto":"udp"},
"tftp":{"desc":"TFTP","externalPort":"69","internalPort":"69","proto":"udp"},
"finger":{"desc":"Finger","externalPort":"79","internalPort":"79","proto":"tcp"},
"http":{"desc":"HTTP","externalPort":"80","internalPort":"80","proto":"tcp"},
"pop3":{"desc":"POP3","externalPort":"110","internalPort":"110","proto":"tcp"},
"nntp":{"desc":"NNTP","externalPort":"119","internalPort":"119","proto":"tcp"},
"snmp":{"desc":"SNMP","externalPort":"161","internalPort":"161","proto":"udp"},
"pptp":{"desc":"PPTP","externalPort":"1723","internalPort":"1723","proto":"tcp"}}
</script>
</HEAD>
<BODY onload="init()">
<form method="post" action="" name="dhcp">

<div class="pop-modal">
<div class="modal-header">
<button class="close logger_bot" type="button" onclick="closePopout()">&#215;</button>
<h3><span class="multi_lang" id="lang_spf_item_creator_title"></span></h3>
</div>
<div class="modal-body">
<table class="table table-info">
<tbody>
<tr>
<td>
<span class="multi_lang" id="lang_spf_item_app_title"></span>
</td>
<td>
<div id="select_div_app_type"></div>
<script>
(function(){
draw_select('app_type', spf_app_str_list, spf_app_val_list,'sel_app_type()', '');
})();
</script>
</td>
</tr>
<tr>
<td>
<span class="multi_lang" id="lang_spf_item_app_name_title"></span>
<td>
<input type="text" class="num logger_bot" maxlength="20" size="19" id="desc" name="desc" onblur="">
</td>
</tr>
<tr>
<td>
<span class="multi_lang" id="lang_spf_item_ext_port_title"></span>
<td>
<input type="text" class="num logger_bot" maxlength="5" style="width:50px" id="externalPort" name="externalPort" onblur="">
</td>
</tr>
<tr>
<td>
<span class="multi_lang" id="lang_spf_item_int_port_title"></span>
<td>
<input type="text" class="num logger_bot" maxlength="5" style="width:50px" id="internalPort" name="internalPort" onblur="">
</td>
</tr>
<tr>
<td>
<span class="multi_lang" id="lang_spf_item_protocol_title"></span>
</td>
<td>
<div id="select_div_proto"></div>
<script>(function(){draw_select('proto', spf_pro_str_list, spf_pro_val_list,'sel_protocol()', '');})();</script>
</td>
</tr>
<tr>
<td>
<span class="multi_lang" id="lang_spf_item_to_ip_title"></span>
<td class="text-left" dir="ltr">
<span id="lan_ipaddr"></span>
<input type="text" class="num logger_bot" maxlength="3" style="width:40px" id="app_ip_to" name="app_ip_to" onblur="">
</td>
</tr>
<tr>
<td>
<span id="checkbox_div_spf_item_enable"></span>
<script>draw_checkbox('spf_item_enable', 'lang_spf_item_enable_title', '1', "spf_item_enable_control()");</script>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="modal-footer">
<button type="button" data-dismiss="modal" class="btn multi_lang logger_bot" onclick="spf_add_item()" id="btnApply"></button>
<button type="button" data-dismiss="modal" class="btn multi_lang logger_bot" onclick="closePopout()" id="btnClose"></button>
</div>
<script type="text/javascript">
//document.title = 'xxxxx';
var IDP_INFO_LIST = [ 'lan' ]
var MODIFIED_OBJ_DATA = {}
var lang_idp = eval('window.parent.L.'+localStorage.iframe_idp_name)
var lang_error = window.parent.L.error_message
var lang_common = window.parent.L.common
var EDIT_FLAG=0
var EDIT_INDEX_ID=null
//resizePopout()
function get_obj_success_cb(obj) {
ORIGINAL_OBJ_DATA = API.obj.copy(obj);
MODIFIED_OBJ_DATA = API.obj.copy(ORIGINAL_OBJ_DATA);
//alert(MODIFIED_OBJ_DATA.lan.LanP.ipaddr);
$("#lan_ipaddr").html(MODIFIED_OBJ_DATA.lan.LanP.ipaddr.split(".")[0]+'.'+MODIFIED_OBJ_DATA.lan.LanP.ipaddr.split(".")[1]+'.'+MODIFIED_OBJ_DATA.lan.LanP.ipaddr.split(".")[2]+'.');
//console.log(MODIFIED_OBJ_DATA)
}
function get_obj_error_cb(obj) {
console.log(obj)
}
function get_obj_data(obj_list){
API.obj.get(obj_list, get_obj_success_cb, get_obj_error_cb);
}
function init()
{
setTimeout(function(){
get_obj_data(IDP_INFO_LIST)
if(typeof(localStorage.iframe_item_data) != "undefined" && localStorage.iframe_item_data != ""){
var item_data = JSON.parse(localStorage.iframe_item_data)
var tmptype="manual";
for(i=0;i<spf_app_val_list.length;i++){
if(item_data.desc.toLowerCase()==spf_app_val_list[i]){
tmptype=spf_app_val_list[i];
}
}
//sel_app_type(item_data.app_type)
sel_app_type(tmptype)
$("#desc").val(item_data.desc)
$("#externalPort").val(item_data.externalPort)
$("#internalPort").val(item_data.internalPort)
$("#app_ip_to").val(item_data.deviceIp.split(".")[3])
sel_protocol(item_data.proto)
spf_item_enable_control(item_data.enable)
EDIT_INDEX_ID = item_data.index
EDIT_FLAG = 1
localStorage.iframe_item_data=""
localStorage.removeItem('iframe_item_data');
}else{
sel_app_type('manual')
spf_item_enable_control('0')
}
$('#loader', window.parent.document).hide();
inject_log_bot_idp()
},1000);

}

function sel_app_type(type){
if(typeof(type) == "undefined")
type = $("#app_type").val()
else
$("#app_type").val(type)

eval('var dy_id="lang_idp.'+$("#app_type option:selected").attr("id")+'"')
$("#app_type").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");

if( "manual" != type ){
eval("var app_data_obj=app_data."+$("#app_type").val())
$("#desc").val(app_data_obj.desc)
$("#desc").attr('disabled', true);
$("#externalPort").val(app_data_obj.externalPort)
$("#externalPort").attr('disabled', true);
$("#internalPort").val(app_data_obj.internalPort)
$("#internalPort").attr('disabled', true);
sel_protocol(app_data_obj.proto)
$("#proto").parent().addClass('disabled');
}else{
$("#desc").val('')
$("#desc").attr('disabled', false);
$("#externalPort").val('')
$("#externalPort").attr('disabled', false);
$("#internalPort").val('')
$("#internalPort").attr('disabled', false);
sel_protocol('both')
$("#proto").parent().removeClass('disabled');
}
}

function sel_protocol(proto){
if(typeof(proto) == "undefined")
proto = $("#proto").val()
else
$("#proto").val(proto)

eval('var dy_id="lang_idp.'+$("#proto option:selected").attr("id")+'"')
$("#proto").siblings( ".selectSpan" ).html("<p>"+eval(dy_id)+"</p>");
}

function spf_item_enable_control(enable){
enable = checkbox_switch('spf_item_enable', enable)
}

function check_rule_repeat(rule_list, target){
rule_list_length = rule_list.length
var ret = true
for(i=0; i< rule_list_length; i++){
if(rule_list[i].desc == target.desc && EDIT_INDEX_ID != i ){
alert(lang_error.lang_error_message_err110);
ret = false
break;
}else if( rule_list[i].externalPort == target.externalPort && rule_list[i].internalPort == target.internalPort && EDIT_INDEX_ID != i ){
alert(lang_error.lang_error_message_err74);
ret = false
break;
}
}
return ret
}

function spf_add_item(){
var item={}
var F = document.forms[0];

if( 'manual' == $("#app_type").val() && "" == $("#desc").val()){
alert(lang_error.lang_error_message_err64);
return false
}

if(valid_range(F.externalPort, 1, 65535, "Port") == false) return false;
if(valid_range(F.internalPort, 1, 65535, "Port") == false) return false;
//item.app_type=$("#app_type").val()
if(valid_range(F.app_ip_to, 1, 254, "IP") == false) return false;
if($("#app_ip_to").val()==MODIFIED_OBJ_DATA.lan.LanP.ipaddr.split(".")[3] || $("#app_ip_to").val()==255 || $("#app_ip_to").val()==0){
//alert("You can't use the Router's IP, network or broadcast address.");
alert(lang_idp.lang_msg_ip_fail);
return;
}
item.desc=$("#desc").val()
item.externalPort=$("#externalPort").val()
item.internalPort=$("#internalPort").val()
item.proto=$("#proto").val()
item.deviceIp=MODIFIED_OBJ_DATA.lan.LanP.ipaddr.split(".")[0]+'.'+MODIFIED_OBJ_DATA.lan.LanP.ipaddr.split(".")[1]+'.'+MODIFIED_OBJ_DATA.lan.LanP.ipaddr.split(".")[2]+'.'+$("#app_ip_to").val()
item.enable=$("#spf_item_enable").val()

if(! check_rule_repeat(window.parent.SPF_DATA, item)){
return false;
}

if(EDIT_FLAG == 1){
parent.insert_spf_item(item, EDIT_INDEX_ID)
}else
parent.insert_spf_item(item)
closePopout()
}
</script>

</FORM></BODY></HTML>