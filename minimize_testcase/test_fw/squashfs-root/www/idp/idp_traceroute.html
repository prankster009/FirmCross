<!DOCTYPE html>
<HTML >
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title></title>
<meta http-equiv="expires" content="0">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link rel="stylesheet" href="/css/all.min.css">
<script src="/js/all.min.js"></script>
<style>
body { display: initial }
.col-md-right { overflow: auto; float: none; height: auto }
body{
background-color: white;
display: block;
}
</style>
</HEAD>
<BODY onload="init()">
<form method="post" action="" name="traceroute">

<div class="pop-modal">
<div class="modal-header">
<button class="close logger_bot" type="button" onclick="closeTracert()">&#215;</button>
<h3><span class="multi_lang" id="lang_idp_traceroute_title"></span></h3>
</div>
<div class="modal-body">
<table class="table table-info" id="traceroute_info">
<tbody>
</tbody>
</table>
</div>
</div>

<div class="modal-footer">
<button type="button" data-dismiss="modal" class="btn multi_lang logger_bot" onclick="stopTracert()" id="btnStop"></button>
<button type="button" data-dismiss="modal" class="btn multi_lang logger_bot" onclick="closeTracert()" id="btnClose"></button>
</div>
<script type="text/javascript">
//document.title = 'xxxxx';

var INFO_LIST = ['traceRoute'];
var INFO_DATA = {"traceRoute":{}};
var L;
var stop_timer=true;
var trace_timer;
var INTERVAL=1000;
var LONG_INTERVAL=10000;
var timer_interval=INTERVAL;

function closeTracert() {
stopTracert()
stop_timer=true;
clearTimeout(trace_timer);
closePopout();
}

function stopTracert()
{
var stop_data = {"traceRoute":""};

stop_timer=true;
set_info_data(stop_data);
}

function init()
{
setTimeout(function(){
L = eval('window.parent.L.'+localStorage.iframe_idp_name)
$('#loader', window.parent.document).hide();

INFO_DATA.traceRoute.ipurl=window.parent.document.forms['ui-form'].tr_ip_url_address.value;
stop_timer=false;
set_info_data(INFO_DATA);
inject_log_bot_idp()
},1000);
}

function refresh_layout(obj) {
var i;

for (i=0; i < obj.traceRoute.length; ++i) {
if (obj.traceRoute[i] == "-1") {
timer_interval=LONG_INTERVAL;
break;
} else if (obj.traceRoute[i].indexOf("bad address") != -1) {
// unknow host
stop_timer=true;
$("#traceroute_info tbody").append('<tr><td>'+L.lang_idp_traceroute_unknow_host_title+'</td></tr>');
break;
}

timer_interval=INTERVAL;
$("#traceroute_info tbody").append('<tr><td>'+obj.traceRoute[i]+'</td></tr>');
}

clearTimeout(trace_timer);
resizePopout();
}

function set_info_success_cb(obj) {
if (!stop_timer)
get_info_data(INFO_LIST);
}
function set_info_error_cb(obj) {
stop_timer=true;
if (obj.api_return == 403) {
logout('sto')
}
}
function set_info_data(obj_content){
if(typeof(obj_content) == 'string')
API.info.set(JSON.parse(obj_content), set_info_success_cb, set_info_error_cb);
else if(typeof(obj_content) == 'object')
API.info.set(obj_content, set_info_success_cb, set_info_error_cb);
}
function get_info_success_cb(obj) {
INFO_DATA = API.obj.copy(obj);

refresh_layout(obj);
if (!stop_timer)
trace_timer = setTimeout(get_info_data, timer_interval, INFO_LIST);
}
function get_info_error_cb(obj) {
stop_timer=true;
if (obj.api_return == 403) {
logout('sto')
}
}
function get_info_data(info_list) {
API.info.get(info_list, get_info_success_cb, get_info_error_cb);
}


</script>

</FORM></BODY></HTML>
